<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Афіша</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <div class="block block-1">
        <h1>Cinema Poster</h1>
        <h2>Перегляд афіші</h2>
    </div>

    <div class="block block-2">
        <h3>Інфо</h3>
        <p>Тут показано всі додані сеанси.</p>
    </div>

    <div class="block block-3">
        <h3>Меню</h3>
        <ul>
            <li><a href="index.html">Додати фільм</a></li>
            <li><a href="index2.html">Переглянути афішу</a></li>
        </ul>
    </div>

    <div class="block block-4">
        <h3>Сьогодні у кіно</h3>
        <div id="movies-container" class="collapse-container"></div>
    </div>

    <div class="block block-5">
        <h3>Управління</h3>
        <form action="server.php" method="POST">
            <input type="hidden" name="clear" value="1">
            <button type="submit" class="btn btn-danger" style="width: 100%;">Очистити список</button>
        </form>
    </div>

    <div class="block block-6"><h2>Promo</h2></div>
    <div class="block block-7"><h3>2025</h3></div>
</div>

<script>
    fetch('movies.json')
        .then(response => {
            if (!response.ok) throw new Error('No file');
            return response.json();
        })
        .then(data => {
            const container = document.getElementById('movies-container');
            
            if (!data || data.length === 0) {
                container.innerHTML = '<p>Афіша пуста.</p>';
                return;
            }

            data.forEach(movie => {
                const item = document.createElement('div');
                item.className = 'collapse-item';
                const safeContent = movie.content.replace(/\n/g, '<br>');

                item.innerHTML = `
                    <button class="collapse-btn">${movie.title}</button>
                    <div class="collapse-content">
                        <div class="collapse-inner">${safeContent}</div>
                    </div>
                `;
                container.appendChild(item);
            });

            addCollapseListeners();
        })
        .catch(error => {
            document.getElementById('movies-container').innerHTML = '<p>Афіша пуста.</p>';
        });

    function addCollapseListeners() {
        var coll = document.getElementsByClassName("collapse-btn");
        for (var i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.maxHeight){
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                } 
            });
        }
    }
</script>

</body>
</html>
